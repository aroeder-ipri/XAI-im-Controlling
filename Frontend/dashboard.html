<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XAI im Controlling</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css">
  <!-- Eigene CSS-Datei -->
  <link rel="stylesheet" href="dashboard.css">
  <!-- Eigene JavaScript-Datei -->
  <script src="dashboard.js" defer></script>
</head>
<body>

<script type="text/javascript">
    var apiUrl = 'https://controlling.xaidemo.de/api/test';
    fetch(apiUrl).then(response => {
      return response.json();
    }).then(data => {
      // Work with JSON data here
      console.log(data);
    }).catch(err => {
      console.log('Error', err)
    });
</script>


<!-- Modalfenster -->
<div id="modal" class="modal">
  <div class="modal-background"></div>
  <div class="modal-content">
    <span class="close">&times;</span>
    <!-- Bootstrap Tabs -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
    </ul>
    <!-- Tab-Inhalte -->
    <div class="tab-content" id="myTabContent">
    </div>
    <br>
    <!-- Link "Mehr" -->
    <a id="mehrButton" class="text-muted" style="position: absolute; bottom: 10px; right: 10px;" href="#">more</a>
  </div>
</div>

<!-- Modalfenster 2 -->
<div id="modal2" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close">&times;</span>
    <!-- Nicht gebraucht aktuell
    <p>Der Umsatz wird auf 109.000 € geschätzt, im Vergleich zum Vormonat mit einem Umsatz von 103.000 €.</p>
    <p>Geben Sie Ihren erwarteten Umsatz an:</p>
    <div style="display: flex; align-items: center;">
      <input type="text" id="zahlInput" style="margin-bottom: 10px; margin-right: 5px;">
      <span>€</span>
      <button id="bestaetigenButton" class="btn custom-btn" style="margin-left: 10px;" disabled>Bestätigen</button>
    </div>-->
  </div>
</div>
  
<!-- Modalfenster 3 -->
<div id="modal3" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Target Setting</h2>
    <p class="hint">You are now able to decide on your store’s sales target for the upcoming year.</p>
    <p>What target do you want to achieve with your store in the upcoming year?</p>
    <!-- Slider Container -->
    <div class="slider-container">
      <label for="targetSlider">Target Value:</label>
      <span id="sliderValue">+0</span>
      <div id="sliderWrapper">
        <span id="minValue">+0</span>
        <input type="range" id="targetSlider" min="0" max="2000" step="10" value="0">
        <span id="maxValue">+2000</span>
      </div>
    </div>
    <!-- Anzeige der erwarteten Auszahlung -->
    <div id="payoutContainer" class="calculation">
      <p class="label">Expected payout for reaching the target:</p>
      <p id="payoutAmount" class="value">$0.00</p>
      <p>Payout for failing to reach the target:</p>
      <p>$0</p>
    </div>
    <button id="setTargetButton" class="custom-btn">Continue</button>
    <button id="finalSetTargetButton" class="custom-btn" style="display: none;">Submit</button>
  </div>
</div>

<!-- Modalfenster 4 -->
<div id="modal4" class="modal">
  <div class="modal-content">
    <p><strong>You can now send a message to your supervisor and ask for advice.</strong></p>
    <div id="messageOptions">
      <button id="noMessageBtn" class="option-btn">No message (no cost)</button>
      <button id="salesExpectationsBtn" class="option-btn">What are your sales expectations from our store?* (-$0.20)</button>
      <button id="trustForecastBtn" class="option-btn">Do you think I should trust the forecast?* (-$0.20)</button>
    </div>
    <p style="font-size: 12px;">*The answer of your supervisor is not dependent on the message you send</p>
  </div>
</div>

<!-- Modalfenster für Nachrichtenbeispiele -->
<div id="messageExampleModal" class="modal" style="display: none;">
  <div class="modal-content">
    <p><strong>Here is the answer of your supervisor:</strong></p>
    <p id="messageExampleText"></p>
    <button id="acknowledgeButton" class="btn custom-btn">Alright, thanks!</button>
  </div>
</div>

<div class="container">
  <!-- Seitenüberschrift -->
  <h1 class="mt-3">Sales development</h1>
  <!-- Content -->
  <div class="row">
    <!-- Linke Seite - Hauptboxen -->
    <div class="col-md-8">
      <div class="content-box1 mt-3">
        <!-- Hier wird der Graph eingebettet -->
        <!-- Der erste Linechart -->
        <canvas id="lineChart" style="display: none;" width="2000" height="600"></canvas>
        <!-- Der zweite Linechart -->
        <canvas id="lineChart2" width="2000" height="600"></canvas>
        <div class="canvas-container">
          <button id="questionButton" class="position-absolute">?</button>
        </div>
      </div>
      <!-- Hier wird der Graph eingebettet -->
      <div class="content-box1 mt-3">
        <canvas id="barChart" width="2000" height="600"></canvas>
      </div>
    </div>
    <!-- Rechte Seite - Nebenboxen -->
    <div class="col-md-4">
      <div class="content-box2 mt-3">
        <h2>Forecast</h2>
        <button type="button" id="anzeigenButton" class="btn custom-btn">show</button>
        <button type="button" id="continueButton" class="btn custom-btn">continue to set target</button>
        <p>Get more information by clicking on <span class="question-mark">?</span> in the forecast.</p>
        <p id="vorhersageAnzeigen" style="display: none;"></p>
      </div>
      <div class="content-box3 mt-3">
        <h2>Change store</h2>
        <!-- Hier werden die Checkboxen dynamisch eingefügt -->
        <div id="storeCheckboxContainer" class="mt-3"></div>
      </div>
      <div class="content-box3 mt-3">
        <div id="storeHeader">
          <h2>Store Info</h2>
          <button id="prevStoreButton"><i class="fas fa-arrow-left"></i></button>
          <span id="currentStore"></span>
          <button id="nextStoreButton"><i class="fas fa-arrow-right"></i></button>
        </div>
        <div id="storeInfoContainer">
          <div id="storeInfo"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <a onclick="btn_click();" id="nextButton" class="btn custom-btn">Further to survey</a>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.2/dist/chart.umd.js"></script>

<script>
function btn_click(){
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const id = urlParams.get('id')
    //Post-Request ans Backend
    window.location.href = "survey.html?id=" + id;
};

document.addEventListener('DOMContentLoaded', (event) => {
  var modal3 = document.getElementById("modal3");
  var modal4 = document.getElementById("modal4");
  var messageExampleModal = document.getElementById("messageExampleModal");
  var continueButton = document.getElementById("continueButton");
  var closeButtons = document.querySelectorAll(".close");
  var targetSlider = document.getElementById("targetSlider");
  var sliderValue = document.getElementById("sliderValue");
  var payoutAmount = document.getElementById("payoutAmount");
  var setTargetButton = document.getElementById("setTargetButton");
  var finalSetTargetButton = document.getElementById("finalSetTargetButton");
  var noMessageBtn = document.getElementById("noMessageBtn");
  var salesExpectationsBtn = document.getElementById("salesExpectationsBtn");
  var trustForecastBtn = document.getElementById("trustForecastBtn");
  var acknowledgeButton = document.getElementById("acknowledgeButton");
  var optionButtons = [noMessageBtn, salesExpectationsBtn, trustForecastBtn];
  var messageExampleText = document.getElementById("messageExampleText");

  var selectedOption = 'noMessage';
  var optionCost = 0.00;

  // Zeige Modal3 bei Klick auf den Continue-Button
  continueButton.onclick = function() {
    modal3.style.display = "block";
  }

  // Schließe alle Modale, wenn der Schließen-Button geklickt wird
  closeButtons.forEach(function(button) {
    button.onclick = function() {
      button.closest('.modal').style.display = "none";
    }
  });

  // Initialisiere den Slider und die Auszahlung
  var initialSliderValue = targetSlider.value;
  sliderValue.textContent = `+${initialSliderValue}`;
  updatePayout(initialSliderValue);

  // Event-Listener für Slider-Eingaben
  targetSlider.oninput = function() {
    var currentValue = this.value;
    sliderValue.textContent = `+${currentValue}`;
    updatePayout(currentValue);
  };

  // Funktion zur Berechnung und Anzeige der Auszahlung
  function updatePayout(value) {
    var basePayout = calculatePayout(value); // Berechne die Basis-Auszahlung
    var payout = basePayout - optionCost; // Ziehe die Kosten für die ausgewählte Option ab
    if (optionCost > 0) {
      payoutAmount.innerHTML = `
        <div class="calculation">
        <p class="value">$${basePayout.toFixed(2)} - <span style="color: red;">$${optionCost.toFixed(2)}</span> = $${Math.max(payout, 0).toFixed(2)}</p>
        </div>
      `;
    } else {
      payoutAmount.innerHTML = `
        <div class="calculation">
        <p class="value">$${basePayout.toFixed(2)}</p>
        </div>
      `;
    }
  }

  // Berechnung der Auszahlung
  function calculatePayout(value) {
    var bonusPerUnit = 0.04 / 100; // 0,04 USD für 100 Einheiten
    return value * bonusPerUnit;
  }

  // Funktion zum Anzeigen von Modal4
  function showModal4() {
    modal4.style.display = "block";
  }

  // Funktion zum Anzeigen des Nachrichtensbeispiel-Modals
  function showMessageExample() {
    var text = `
      <p>Hello,</p>
      <p>I appreciate your message and I can see you have already made an educated guess on your sales targets.</p>
      <p>Even though our AI prediction is expecting an increase in sales of +400 units, I think there is reason to believe that sales can increase up to +1000 units in the upcoming year.</p>
      <p>Kind Regards,</p>
      <p>Supervisor</p>
    `;
    messageExampleText.innerHTML = text; // Setze HTML-Inhalt
    messageExampleModal.style.display = "block";
  }

  // Event-Listener für den Set Target Button
  setTargetButton.onclick = function() {
    showModal4();
  }

  // Funktion zur Auswahl einer Option im Modal4
  function selectOption(optionId) {
    selectedOption = optionId;
    optionButtons.forEach(function(btn) {
      btn.classList.remove('active');
    });
    document.getElementById(optionId + 'Btn').classList.add('active');
    optionCost = calculateOptionCost(selectedOption);
    updatePayout(targetSlider.value); // Aktualisiere die Auszahlung nach Auswahl der Option
  }

  function showHintInModal3(text) {
    var modal3 = document.getElementById('modal3');
    var hintElement = modal3.querySelector('.hint');
    if (hintElement) {
      hintElement.textContent = text;
    }
  }

  // Event-Listener für die Auswahloptionen im Modal4
  optionButtons.forEach(function(button) {
    button.addEventListener('click', function() {
      var optionId = this.id.replace('Btn', '');
      var exampleText = "";
      var hintText = "";

      if (optionId === 'noMessage') {
        modal4.style.display = "none";
        optionCost = 0.00; // Keine Kosten
        hintText = "You can now adjust your target level one last time. ";
      } else {
        if (optionId === 'salesExpectations') {
          exampleText = "What are your sales expectations from our store?";
          hintText = "After asking your supervisor you can now adjust your target level one last time.";
        } else if (optionId === 'trustForecast') {
          exampleText = "Do you think I should trust the forecast?";
          hintText = "After asking your supervisor you can now adjust your target level one last time.";
        }
        modal4.style.display = "none";
        showMessageExample(exampleText);
        optionCost = 0.20; // Abzug der Kosten für die ausgewählte Option
      }

      // Zeige den Hinweistext in Modal3
      showHintInModal3(hintText);

      // Blende den Set Target Button aus und zeige den Final Set Target Button an
      setTargetButton.style.display = "none";
      finalSetTargetButton.style.display = "block";

      updatePayout(targetSlider.value); // Aktualisiere die Auszahlung
    });
  });

    // Event-Listener für den Final Set Target Button
    finalSetTargetButton.onclick = function() {
    // Blende den Final Set Target Button aus
    finalSetTargetButton.style.display = "none";
    // Schließe Modal3
    modal3.style.display = "none";
    // Mache den Continue-Button nicht mehr klickbar
    continueButton.style.pointerEvents = "none";
    continueButton.style.opacity = "0.5";
  };

  // Event-Listener für den "Alright, thanks!" Button
  acknowledgeButton.onclick = function() {
    // Schließe das Nachrichtensbeispiel-Modal
    messageExampleModal.style.display = "none";
    // Berechne und aktualisiere die Auszahlung
    var currentValue = targetSlider.value;
    updatePayout(currentValue);
    // Zeige Modal3 wieder an
    modal3.style.display = "block";
  };

  // Berechnung der Kosten für die Auswahloptionen
  function calculateOptionCost(option) {
    switch(option) {
      case 'salesExpectations':
      case 'trustForecast':
        return 0.20;
      default:
        return 0.00;
    }
  }
});
</script>
  
</body>
</html>
